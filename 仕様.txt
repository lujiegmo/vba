計算期間の最初日を計算する関数を作ってください。
計算方法について、まずは[未返済年月1]の前月の1日を初期値として最初日にセットしてください。
その後、[入出金情報]にこの最初日より小さい日付があるかどうか確認してください。
あれば、この最初日を戻ってください。
なければ、「未返済年月1の前月」がこの最初日より大きいかをチェックしてください。
もし「未返済年月1の前月」が最初日より小さい場合は、この最初日を戻ってください。
上記以外の場合は、[入出金情報]の最小日付と「未返済年月1の前月」を比較して、小さいのほうをもどってください。

出力データを用意します。
１．まずは返済予定情報取得を行う。
２．返済予定情報の2レコード目からループする、該当行は返済予定データとして、前レコードは返済予定前月データとします。
３．返済予定データの前1か月の初日を取得して計算期間の最初日とする。ただ、「計算期間最初日取得」より取得した日付よりも小さければ、取得した日付を最初日とする。
４．返済予定データの前1か月の月末日を取得して計算期間の最終日とする。
５．この最初日と最終日で一つの出力レコードを作成する。
６．「返済予定前月データ」の日付がが最初日と最終日の間であれば、レコードを分割する。
７．[入出金情報]の日付が最初日と最終日の間であれば、レコードを分割する（複数件だったら複数回分割）。ただ、６の分割日と同じであれば、一つの分割となります。
８．「借入利率取得」データの中、開始日が最初日と最終日の間であれば、レコードを分割する。上記と同じく、分割日が同じであれば、一つの分割となります。
９．「遅延損害金利率取得」データの中、開始日が最初日と最終日の間であれば、レコードを分割する。上記と同じく、分割日が同じであれば、一つの分割となります。
１０．出力レコードの値を設定する。下記の通り
ステータス：正常
イベント：約定返済
約定返済月：返済予定データの年月
計算期間開始日：一番目のレコードであれば、最初日、その以外は分割日
計算期間終了日：最後のレコードであれば、最終日、その以外は次の分割日-１日
対象元金：[入出金情報]に計算期間開始日より小さいの日付の中、最大日付のデータの「残高」-「延滞中の約定返済元金合計」で算出する。
　　　　　ただ、計算期間開始日が返済予定前月データの日付と同じかより大きい場合は、さらに返済予定前月データの返済元金累計を減らす
計算日数：計算期間終了日-計算期間開始日+1
利率：借入利率取得データの中、開始日が計算期間開始日と同じのデータの利率、日付同じのデータがなければ、計算期間開始日より小さい日付の中一番大きいのやつを対象とする
積数：設定不可（Excel数式あり）
利息金額：設定不可（Excel数式あり）
遅延損害金：設定不可（Excel数式あり）


計算書作成というSUBをつくって、ツールシートを引数として、「正常分出力データ作成」と「計算書の作成パス取得」を呼びます。

ファイル出力関数を作成してください。下記の処理を行う
１．「計算書の作成パス取得」から取得したフォルダの配下に、ファイル名が「利息計算書」+年月日+”_”+時分秒+”.xlsx”となるExcelファイルを作成してください。
２．「正常分出力データ作成」で取得したデータを、このファイルのA9セルから貼り付けてください。
３．ファイル保存
４．msgで完了する


